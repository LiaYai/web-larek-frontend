# Проектная работа "Веб-ларек"

Web-ларёк - интернет-магазин с товарами для веб-разработчиков. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ. 

## Описание проекта
Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара

```
interface ICard {
  id: string;
  category: string;
  title: string;
  description: string;
  image: string;
  price: number | null;
}
```

Данные форм заказа

```
interface IOrderForm {
  address: string;
  email: string;
  phone: string;
}
```

Данные заказа

```
interface IOrder extends IOrderForm {
  payment: TPayment;
  items: string[],
  total: number
}
```

Данные результата заказа

```
interface IOrderResult {
  id: string;
}
```

Тип данных для формы оплаты

```
type TPayment = 'card' | 'cash';
```

Тип данных для ошибок валидации форм заказа

```
type TFormErrors = Partial<Record<keyof IOrder, string>>;
```

Тип данных для методов взаимодействия с Api
```
interface IAPI {
  getCatalog: () => Promise<ICard[]>;
  getSelectedCard: (id: string) => Promise<ICard>;
  placeOrder: (order: IOrder) => Promise<IOrderResult>;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP
- слой представления отвечает за отображение данных на странице
- слой данных отвечает за хранение и изменение данных
- презентер отвечает за связь представления и данных

### Базовый код

#### Класс API

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и объект с заголовками запросов.
Поля класса - базовый Url и объект запросов.
Имеет методы:
- get -  отправляет `GET`- запрос по указанному url (относительно `baseUrl`) и возвращает промис c данными ответа, обработанными методом handleResponse.
- post - отправляет POST-запрос (по умолчанию, может быть использован для `PUT` или `DELETE`) по указанному url (так же относительно `baseUrl`) с предоставленными данными и возвращает промис с данными ответа, обработанными методом `handleResponse`.

#### Класс EventEmitter

Брокер событий, позволяющий подписываться на события и уведомлять подписчиков о наступлении события.
Класс имеет методы:
- `on` — для подписки на событие, 
- `off` - для отписки от события,  
- `onAll` — для подписки на все события, 
- `offAll` - для отписки от всех событий, 
- `emit` - уведомления подписчиков о наступлении события,
- `trigger` - генерирует заданное событие с заданными параметрами, что позволяет передавать его в качестве обработчика события в другие классы.

#### Класс Model\<T\>
Абстрактный класс `Model` предназначен для расширения другими классами для представления моделей данных. 

Конструктор инициализирует новый экземпляр модели с предоставленными данными и брокером событий.

Метод `emitChanges` - уведомляет всех слушателей о том, что модель изменилась, передавая название события и, возможно, данные для изменения.

#### Класс Component\<T\>

Абстрактный класс, реализующий общие для компонентов представления методы.

`constructor` - конструктор принимает аргументом DOM-элемент - контейнер.

Методы класса:
- `toggleClass` - переключает CSS-класс.
- `setText` - устанавливает текст в переданном элементе.
- `setDisabled` - устанавливает или убирает атрибут `disabled` у переданного элемента.
- `setImage` - устанавливает переданному элементу значение `src` и при наличии `alt`.
- `render` - возвращает DOM-элемент - контейнер. Перед возвратом он объединяет свойства контейнера с переданными данными `data`.

### Слой данных

#### Класс ShopAPI

Наследует класс `Api` расширяется интерфейсом `IAPI`. Он предоставляет методы для взаимодействия с API.

Имеет свойство `cdn` для формирования адреса картинки в карточке товара.

Методы:
- `getCatalog` - получает список товаров, формирует URL изображений с помощью URL изображения и `cdn`.
- `getSelectedCard` - получает карточку товара по `id` и формирует URL изображения с помощью URL и `cdn`.
- `placeOrder` - размещает заказ и возвращает промис с результатом.

#### Класс AppState 

Класс расширяет класс `Model`, отвечает за хранение данных товаров, данных о корзине товаров и заказе, предпросмотр карточки товара и тд.\
Конструктор класса принимает экземпляр брокера событий.

Поля класса:
- `catalog` - массив объеков товаров.
- `preview` - id карточки, выбранной для превью товара.
- `order` - объект с данными заказа: видом оплаты, адресом, эл.почтой, телефоном, списком товаров в корзине(их id).
- `formErrors` - объект с ошибками валидации форм.

Методы класса:
- `setCatalog`- устанавливает каталог карточек товаров.
- `setCardPreview` - устанавливает карточку для превью.
- `changeBasket` - добавить/удалить товар в корзине.
- `getBasket` - получить массив карточек-данных в корзине.
- `getTotalPrice` - возвращает сумму заказа.
- `clearBasket` - очищает корзину.
- `validateOrderInfo` - проверяет данные формы первого окна заказа на валидность. 
- `validateOrderContacts` - проверяет данные формы второго окна заказа на валидность. 
- `setOrderInfo` - заполняет данными поля формы первого окна заказа. 
- `setOrderContacts` - заполняет данными поля формы второго окна заказа. 
- `setOrderPayment` - заполнить вид оплаты.

### Слой представления

Классы представления отвечают за отображение передаваемых в них данных внутри контейнера - DOM элемента.

#### Класс Modal

Реализует модальное окно, расширяет класс `Component`. 

Поля класса:
- `closeButton` - элемент кнопки закрытия окна (крестик).
- `content` - содержимое элемента, выбранного по селектору, переданного в конструктор.

Конструктор принимает в качестве аргумента селектор, по которому в разметке будет выбран элемент модального окна(контейнер) и экземпляр класса EventEmitter для возможности инициализации событий.
Устанавливает слушатели на события клика по кнопке-крестик и клика на оверлей, которые вызывают закрытие окна.

Имеет сеттер, который принимает DOM-элемент и заменяет дочерние элементы контейнера версткой этого элемента. 

Методы: 
- `open` и `close` - для открытия и закрытия модального окна.
- `render` - принимает HTMLElement, отрисовывает модальное окно с данными этого элемента и открывает его. 

#### Класс Form

Общий класс для форм заказа, расширяет `Component`. Используется для обработки событий ввода и отправки формы.

Поля класса:
- `submit` - элемент кнопки сабмита формы.
- `errors` - элемент с ошибкой ввода формы. 

Конструктор принимает элемент формы и обработчик событий. Присваивает полям соответствующие элементы формы - кнопку и элемент с ошибкой.

Устанавливает слушатели на изменение полей ввода и на кнопку отправки.

Сеттеры:
- `errors` - устанавливает текст ошибки в разметку.
- `valid` - вкл/выкл кнопку отправки, в соответствии с валидностью формы.

Методы класса:
- `onInputChange` - вызывает событие изменения, когда поле ввода формы меняется, передавая имя поля и значение в качестве данных события.
- `render` - отрисовывает компонент формы с переданными данными состояния, включая значения полей ввода и валидность. Возвращает отрисованный контейнер формы.

#### Класс Card

Реализует карточку товара, расширяет класс `Component`.

Имеет поля:
- `title` - элемент названия товара.
- `category` - элемент категории товара.
- `image` - элемент изображения товара.
- `description` - элемент описания товара.
- `price` - элемент с ценой товара.
- `button` - элемент кнопки в товаре.
- `index` - элемент с номером товара в корзине.

Конструктор инициализирует компонент-карточку с именем блока, контейнерным элементом и необязательными действиями. Присваивает полям соответствующие элементы формы. Устанавливает на `button` обработчик клика, если действие передано.

Сеттеры и геттеры:
- `index` - установить порядковый номер товара.
- `id` - получить id карточки.
- `title` - установить заголовок карточки.
- `category` - установить категорию товара.
- `image` - установить изображения товара.
- `description` - установить описание товара.
- `price` - установить цену товара.
- `buttonText` - установить текст кнопки в товаре в превью.

#### Класс Page

Реализует главную страницу, расширяет класс `Component`.

Поля класса:
- `catalog` - массив элементов каталога.
- `basket` - элемент корзины.
- `counter` - элемент, содержащий количество товаров в корзине.
- `wrapper` - элемент-обертка содержимого  главной страницы

Конструктор принимает в качестве аргумента селектор, по которому в разметке будет выбран контейнер каталога товаров и экземпляр класса EventEmitter. В конструкторе каждому полю присваивается соответствующий элемент разметки. Элементу корзины устанавливается слушатель, который вызывает событие для открытия корзины по клику.

Сеттеры:

- `counter` - устанаваливает количество товаров в соответствующее поле.
- `catalog` - заменяет содеримое контейнера главной страницы на переданный масссив элементов.
- `locked` - устанаваливает блокировку прокрутки страницы добавляя нужный класс `wrapper`.  

#### Класс OrderInfo

Реализует содержимое окна заказа с формой оплаты и адресом доставки, расширяет класс `Form`.

Конструктор принимает в качестве аргумента селектор, по которому в разметке будет выбран темплейт формы со способом оплаты и адресом доставки, и экземпляр класса EventEmitter.

Сеттеры:
- `selected` - одной кнопке выбора оплаты  присваивает активное состояние, другой - неактивное.
- `address` - присваивает значение элементу формы с именем address. 

#### Класс OrderContacts

Реализует содержимое окна заказа с контактами, расширяет класс `Form`.

Конструктор принимает в качестве аргумента селектор, по которому в разметке будет выбран темплейт формы с контактами и экземпляр класса EventEmitter.

Сеттеры:
- `phone` - присваивает значение элементу формы с именем phone.
- `email` - присваивает значение элементу формы с именем email.

#### Класс Success

Реализует содержимое модального окна успешной покупки, расширяет класс `Component`.

Поля класса:

- `description` - элемент содержащий общую стоимость заказа в `textContent`.
- `close__button` - элемент кнопки.

Конструктор принимает в качестве аргументов селектор, по которому в разметке будет выбран темплейт окна Success и экземпляр класса EventEmitter. В конструкторе каждому полю присваивается соответствующий элемент разметки. Кнопке навешивается слушатель, который закрывает модальное окно. 

Имеет сеттер, который устанавливает в поле `description` сумму `total`.

#### Класс Basket

Реализует корзину товаров, расширяет класс `Component`.

Поля класса:
- `list` -  элемент списка выбранных товаров.
- `total` - элемент отображающий общую сумму.
- `button` - элемент кнопки.

Конструктор принимает в качестве аргумента селектор, по которому в разметке будет выбран темплейт корзины и экземпляр класса EventEmitter. В конструкторе каждому полю присваивается соответствующий элемент разметки. Кнопке сабмита устанавливается слушатель, который вызывает событие создания заказа при клике.

Сеттеры класса:
- `items` - сеттер для списка выбранных товаров, помещает в `list` элементы карточек товара. Если список пуст, то пишет, что корзина пуста.
- `selected` - сеттер для кнопки "Оформить", делает ее активной, если список товаров не пуст и наоборот.
- `total` - сеттер для суммы корзины, устанавливает в элемент `total` общую стоимость товаров.

### События

`modal:open` - происходит при клике на корзину, товар в каталоге, кнопке "Оформить" в корзине, кнопке "Далее" в первом окне заказа, кнопке "Оплатить" во втором окне заказа. Вызывает открытие модального окна и блокирует действия вне модального окна.

`modal:close` - происходит при клике вне модального окна и на кнопке-кретик модального окна. Вызывает закрытие модального окна и снимает блокировку со страницы.

`catalog:loaded` - происходит при загрузке страницы. Добавляет товары в каталог и добавляет число товаров в корзине на изображение корзины.

`card:select` - происходит при нажатии на карточку товара в каталоге.

`preview:changed` - открывает модальное окно и отрисовывает в нем карточку товара.

`basket:open` - отрисовывает разметку корзины.

`basketItems:changed` - происходит при добавлении или удалении товара в корзине и в окне превью товара.

`basket:changed` - происходит изменении количества товаров в корзине. Вызывает отрисовку обновленной корзины, пересчет суммы заказа и обновление счетчика корзины на главной странице.

`order:open` - происходит при клике на кнопку "Оформить" в корзине. Вызывает отрисовку первой формы заказа.

`order:submit` - происходит при клике на кнопку "Далее" в первом окне заказа. Вызывает отрисовку второй формы заказа.

`contacts:submit` - происходит при клике на кнопку "Оплатить" во втром окне заказа. Вызывает отправление данных заказа, очистку корзины, данных заказа и открытие окна подтверждения заказа.

`formInfoErrors:change`, `formContactsErrors:change` - происходит при ошибке заполнения форм заказа. Выводит текст ошибки.

`/^order\..*:change/`, `/^contacts\..*:change/` - происходит при изменени полей заказа. Устанавливает данные полей в данные заказа.
